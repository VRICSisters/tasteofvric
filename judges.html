<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Judges Panel - Taste of VRIC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .back-btn {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .back-btn:hover {
            text-decoration: underline;
        }
        
        .setup-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .judge-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #5568d3;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .judge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .judge-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .judge-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .judge-card.selected {
            background: #667eea;
            color: white;
            border-color: #5568d3;
        }
        
        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 30px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .rating-group {
            margin-bottom: 25px;
        }
        
        .rating-group h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .rating-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        
        .rating-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .rating-btn:hover {
            transform: translateY(-2px);
        }
        
        .rating-btn.selected {
            color: white;
            border-width: 3px;
        }
        
        .rating-btn[data-value="1"] { border-color: #dc2626; }
        .rating-btn[data-value="1"].selected { background: #dc2626; border-color: #991b1b; }
        
        .rating-btn[data-value="2"] { border-color: #f97316; }
        .rating-btn[data-value="2"].selected { background: #f97316; border-color: #c2410c; }
        
        .rating-btn[data-value="3"] { border-color: #fbbf24; }
        .rating-btn[data-value="3"].selected { background: #fbbf24; border-color: #d97706; color: #000; }
        
        .rating-btn[data-value="4"] { border-color: #84cc16; }
        .rating-btn[data-value="4"].selected { background: #84cc16; border-color: #4d7c0f; }
        
        .rating-btn[data-value="5"] { border-color: #22c55e; }
        .rating-btn[data-value="5"].selected { background: #22c55e; border-color: #15803d; }
        
        .results {
            margin-top: 30px;
        }
        
        .category-results {
            margin-bottom: 30px;
        }
        
        .category-results h3 {
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .winner-card {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .winner-card h4 {
            color: #333;
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .runner-up {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .emergency-contact {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #dc2626;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .tie-option {
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tie-option:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .tie-option.selected {
            background: #667eea;
            color: white;
            border-color: #5568d3;
        }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div id="setupScreen" class="container screen active">
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
        <h1>‚öñÔ∏è Judges Panel Setup</h1>
        
        <div class="setup-form">
            <div class="form-group">
                <label>Number of Judges</label>
                <input type="number" id="judgeCount" min="1" max="10" value="4">
            </div>
            
            <div class="form-group">
                <label>Judge Names (one per line)</label>
                <div class="judge-inputs" id="judgeInputs"></div>
            </div>
            
            <button onclick="startJudging()">Start Judging</button>
        </div>
    </div>
    
    <!-- Judge Selection Screen -->
    <div id="judgeSelectScreen" class="container screen">
        <h1>Select Your Judge</h1>
        <div class="judge-grid" id="judgeGrid"></div>
    </div>
    
    <!-- Dish Selection Screen -->
    <div id="dishSelectScreen" class="container screen">
        <h1 id="judgeWelcome"></h1>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar">0 / 0 rated</div>
        </div>
        
        <div class="form-group">
            <label>Select Dish to Rate</label>
            <select id="dishSelect" onchange="loadRatingForm()">
                <option value="">Choose a sticker number...</option>
            </select>
        </div>
        
        <button onclick="backToJudgeSelect()">Change Judge</button>
        
        <div id="completeButton" style="display: none; margin-top: 20px;">
            <button onclick="showCompleteModal()" style="background: #22c55e;">Complete Scoring</button>
        </div>
    </div>
    
    <!-- Rating Screen -->
    <div id="ratingScreen" class="container screen">
        <h1 id="dishTitle"></h1>
        
        <form id="ratingForm">
            <div class="rating-group">
                <h3>Taste & Flavor</h3>
                <div class="rating-buttons" id="taste"></div>
            </div>
            
            <div class="rating-group">
                <h3>Texture & Doneness</h3>
                <div class="rating-buttons" id="texture"></div>
            </div>
            
            <div class="rating-group">
                <h3>Intentionality & Thoughtfulness</h3>
                <div class="rating-buttons" id="intentionality"></div>
            </div>
            
            <div class="rating-group">
                <h3>Presentation</h3>
                <div class="rating-buttons" id="presentation"></div>
            </div>
            
            <div class="rating-group">
                <h3>Category Fit</h3>
                <div class="rating-buttons" id="categoryFit"></div>
            </div>
            
            <div class="form-group">
                <label>Notes (Optional)</label>
                <textarea id="notes" rows="3" placeholder="Any additional comments..."></textarea>
            </div>
            
            <button type="submit">Submit Rating</button>
            <button type="button" onclick="backToDishSelect()" style="background: #6c757d; margin-top: 10px;">Back</button>
        </form>
    </div>
    
    <!-- Results Screen -->
    <div id="resultsScreen" class="container screen">
        <h1>üèÜ Competition Results</h1>
        <div id="resultsContent"></div>
    </div>
    
    <!-- Complete Scoring Modal -->
    <div id="completeModal" class="modal">
        <div class="modal-content">
            <h3>Complete Scoring</h3>
            <p>Enter admin password to finalize results:</p>
            <input type="password" id="completePassword" placeholder="Admin password">
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="closeCompleteModal()" style="background: #6c757d;">Cancel</button>
                <button onclick="completeScoring()" style="background: #22c55e;">Complete</button>
            </div>
        </div>
    </div>
    
    <!-- Tiebreaker Modal -->
    <div id="tiebreakerModal" class="modal">
        <div class="modal-content">
            <h3>Tiebreaker Vote</h3>
            <p id="tieCategory"></p>
            <div id="tieOptions"></div>
            <button onclick="submitTiebreaker()" style="margin-top: 20px;">Submit Decision</button>
        </div>
    </div>
    
    <div id="emergencyContact" class="emergency-contact" style="display: none;">
        üìû If you need help: Text Br Usman at 305-763-0271. He built this back in 2016, he might not remember how all this works. Be patient.
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBLuoW3l8TM9s-C47uNF0gxDBmzYfGq_Z0",
            authDomain: "tasteofvric-97d8b.firebaseapp.com",
            projectId: "tasteofvric-97d8b",
            storageBucket: "tasteofvric-97d8b.firebasestorage.app",
            messagingSenderId: "538483030204",
            appId: "1:538483030204:web:5a0414d9bf35bcf2e238b9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.doc = doc;
        window.getDoc = getDoc;
        window.setDoc = setDoc;
    </script>

    <script>
        let currentYear = 2026;
        let currentJudge = '';
        let currentDish = '';
        let allJudges = [];
        let allEntries = [];
        let allScores = [];
        let judgesData = {};
        let tiebreakers = {};
        
        async function loadYear() {
            const configDoc = await window.getDoc(window.doc(window.db, 'config', 'settings'));
            if (configDoc.exists()) {
                currentYear = configDoc.data().currentYear;
            }
            await loadJudgesData();
        }
        
        async function loadJudgesData() {
            const judgesDoc = await window.getDoc(window.doc(window.db, 'judges', currentYear.toString()));
            
            if (judgesDoc.exists()) {
                judgesData = judgesDoc.data();
                allJudges = judgesData.judges || [];
                allScores = judgesData.scores || [];
                
                if (judgesData.completed) {
                    showResults();
                } else if (allJudges.length > 0) {
                    showJudgeSelect();
                } else {
                    showSetup();
                }
            } else {
                showSetup();
            }
            
            const entriesDoc = await window.getDoc(window.doc(window.db, 'entries', currentYear.toString()));
            if (entriesDoc.exists()) {
                allEntries = entriesDoc.data().entries || [];
            }
        }
        
        function showSetup() {
            hideAllScreens();
            document.getElementById('setupScreen').classList.add('active');
            
            const count = document.getElementById('judgeCount').value || 4;
            updateJudgeInputs(count);
        }
        
        document.getElementById('judgeCount')?.addEventListener('change', function() {
            updateJudgeInputs(this.value);
        });
        
        function updateJudgeInputs(count) {
            const container = document.getElementById('judgeInputs');
            container.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = `Judge ${i} Name`;
                input.id = `judge${i}`;
                input.required = true;
                container.appendChild(input);
            }
        }
        
        async function startJudging() {
            const count = parseInt(document.getElementById('judgeCount').value);
            allJudges = [];
            
            for (let i = 1; i <= count; i++) {
                const name = document.getElementById(`judge${i}`).value.trim();
                if (!name) {
                    alert(`Please enter name for Judge ${i}`);
                    return;
                }
                allJudges.push(name);
            }
            
            judgesData = {
                judges: allJudges,
                scores: [],
                completed: false,
                year: currentYear
            };
            
            await window.setDoc(window.doc(window.db, 'judges', currentYear.toString()), judgesData);
            
            showJudgeSelect();
        }
        
        function showJudgeSelect() {
            hideAllScreens();
            document.getElementById('judgeSelectScreen').classList.add('active');
            
            const grid = document.getElementById('judgeGrid');
            grid.innerHTML = '';
            
            allJudges.forEach(judge => {
                const card = document.createElement('div');
                card.className = 'judge-card';
                card.textContent = judge;
                card.onclick = () => selectJudge(judge);
                grid.appendChild(card);
            });
        }
        
        function selectJudge(judge) {
            currentJudge = judge;
            showDishSelect();
        }
        
        function showDishSelect() {
            hideAllScreens();
            document.getElementById('dishSelectScreen').classList.add('active');
            document.getElementById('judgeWelcome').textContent = `Welcome, ${currentJudge}!`;
            
            // Show emergency contact only for Judge 1
            if (currentJudge === allJudges[0]) {
                document.getElementById('emergencyContact').style.display = 'block';
            } else {
                document.getElementById('emergencyContact').style.display = 'none';
            }
            
            updateDishList();
            updateProgress();
            checkCompleteButton();
        }
        
        function updateDishList() {
            const select = document.getElementById('dishSelect');
            select.innerHTML = '<option value="">Choose a sticker number...</option>';
            
            // Get dishes this judge hasn't rated yet
            const ratedStickers = allScores
                .filter(s => s.judge === currentJudge)
                .map(s => s.stickerNumber);
            
            allEntries.forEach(entry => {
                const option = document.createElement('option');
                option.value = entry.stickerNumber;
                option.textContent = `#${entry.stickerNumber} - ${entry.dish}`;
                
                // Mark as rated
                if (ratedStickers.includes(entry.stickerNumber)) {
                    option.textContent += ' ‚úì';
                }
                
                select.appendChild(option);
            });
        }
        
        function updateProgress() {
            const totalDishes = allEntries.length;
            const ratedDishes = allScores.filter(s => s.judge === currentJudge).length;
            const percentage = totalDishes > 0 ? (ratedDishes / totalDishes) * 100 : 0;
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `${ratedDishes} / ${totalDishes} rated`;
        }
        
        function checkCompleteButton() {
            // Show complete button only for Judge 1
            if (currentJudge !== allJudges[0]) {
                document.getElementById('completeButton').style.display = 'none';
                return;
            }
            
            // Check if at least 80% of dishes are rated by all judges
            const totalDishes = allEntries.length;
            const requiredRatings = Math.ceil(totalDishes * 0.8);
            
            const allJudgesReady = allJudges.every(judge => {
                const judgeRatings = allScores.filter(s => s.judge === judge).length;
                return judgeRatings >= requiredRatings;
            });
            
            if (allJudgesReady) {
                document.getElementById('completeButton').style.display = 'block';
            } else {
                document.getElementById('completeButton').style.display = 'none';
            }
        }
        
        function loadRatingForm() {
            const stickerNumber = document.getElementById('dishSelect').value;
            if (!stickerNumber) return;
            
            currentDish = stickerNumber;
            const entry = allEntries.find(e => e.stickerNumber === stickerNumber);
            
            hideAllScreens();
            document.getElementById('ratingScreen').classList.add('active');
            document.getElementById('dishTitle').textContent = `Rate Dish #${stickerNumber}`;
            
            // Create rating buttons
            ['taste', 'texture', 'intentionality', 'presentation', 'categoryFit'].forEach(category => {
                const container = document.getElementById(category);
                container.innerHTML = '';
                
                for (let i = 1; i <= 5; i++) {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'rating-btn';
                    btn.dataset.value = i;
                    btn.dataset.category = category;
                    btn.textContent = i;
                    btn.onclick = () => selectRating(category, i);
                    container.appendChild(btn);
                }
            });
            
            // Load existing rating if it exists
            const existingRating = allScores.find(s => s.judge === currentJudge && s.stickerNumber === stickerNumber);
            if (existingRating) {
                document.getElementById('notes').value = existingRating.notes || '';
                ['taste', 'texture', 'intentionality', 'presentation', 'categoryFit'].forEach(cat => {
                    selectRating(cat, existingRating[cat]);
                });
            }
        }
        
        function selectRating(category, value) {
            const container = document.getElementById(category);
            container.querySelectorAll('.rating-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const btn = container.querySelector(`[data-value="${value}"]`);
            if (btn) btn.classList.add('selected');
        }
        
        document.getElementById('ratingForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const ratings = {};
            let allRated = true;
            
            ['taste', 'texture', 'intentionality', 'presentation', 'categoryFit'].forEach(cat => {
                const selected = document.querySelector(`#${cat} .rating-btn.selected`);
                if (selected) {
                    ratings[cat] = parseInt(selected.dataset.value);
                } else {
                    allRated = false;
                }
            });
            
            if (!allRated) {
                alert('Please rate all categories');
                return;
            }
            
            const newRating = {
                judge: currentJudge,
                stickerNumber: currentDish,
                taste: ratings.taste,
                texture: ratings.texture,
                intentionality: ratings.intentionality,
                presentation: ratings.presentation,
                categoryFit: ratings.categoryFit,
                notes: document.getElementById('notes').value.trim(),
                timestamp: new Date().toISOString()
            };
            
            // Remove existing rating if editing
            allScores = allScores.filter(s => !(s.judge === currentJudge && s.stickerNumber === currentDish));
            allScores.push(newRating);
            
            judgesData.scores = allScores;
            await window.setDoc(window.doc(window.db, 'judges', currentYear.toString()), judgesData);
            
            alert('Rating submitted!');
            showDishSelect();
        });
        
        function showCompleteModal() {
            document.getElementById('completeModal').classList.add('active');
        }
        
        function closeCompleteModal() {
            document.getElementById('completeModal').classList.remove('active');
            document.getElementById('completePassword').value = '';
        }
        
        async function completeScoring() {
            const password = document.getElementById('completePassword').value;
            
            if (password !== 'adminVR!C') {
                alert('Incorrect admin password');
                return;
            }
            
            // Check for ties
            const hasTies = await checkForTies();
            
            if (hasTies) {
                closeCompleteModal();
                return; // Tiebreaker modal will handle completion
            }
            
            // No ties, complete scoring
            await finalizeResults();
        }
        
        async function checkForTies() {
            const categories = ['Appetizer', 'Entree', 'Dessert'];
            let hasTies = false;
            tiebreakers = {};
            
            for (const category of categories) {
                const categoryEntries = allEntries.filter(e => e.category === category);
                const averages = {};
                
                categoryEntries.forEach(entry => {
                    const scores = allScores.filter(s => s.stickerNumber === entry.stickerNumber);
                    if (scores.length > 0) {
                        const total = scores.reduce((sum, s) => sum + s.taste + s.texture + s.intentionality + s.presentation + s.categoryFit, 0);
                        averages[entry.stickerNumber] = total / scores.length;
                    }
                });
                
                const sorted = Object.entries(averages).sort((a, b) => b[1] - a[1]);
                
                // Check for tie at first place
                if (sorted.length > 1 && sorted[0][1] === sorted[1][1]) {
                    hasTies = true;
                    showTiebreakerModal(category, sorted.filter(s => s[1] === sorted[0][1]));
                    break;
                }
            }
            
            return hasTies;
        }
        
        function showTiebreakerModal(category, tiedDishes) {
            document.getElementById('tieCategory').textContent = `Choose the winner for ${category}:`;
            
            const optionsContainer = document.getElementById('tieOptions');
            optionsContainer.innerHTML = '';
            
            tiedDishes.forEach(([sticker, score]) => {
                const entry = allEntries.find(e => e.stickerNumber === sticker);
                const option = document.createElement('div');
                option.className = 'tie-option';
                option.innerHTML = `<strong>#${sticker}</strong> - ${entry.dish}<br><small>Score: ${score.toFixed(2)}</small>`;
                option.onclick = () => {
                    optionsContainer.querySelectorAll('.tie-option').forEach(o => o.classList.remove('selected'));
                    option.classList.add('selected');
                    tiebreakers[category] = sticker;
                };
                optionsContainer.appendChild(option);
            });
            
            document.getElementById('tiebreakerModal').classList.add('active');
        }
        
        async function submitTiebreaker() {
            // Make sure a choice was made
            const categories = Object.keys(tiebreakers);
            if (categories.length === 0) {
                alert('Please select a winner');
                return;
            }
            
            document.getElementById('tiebreakerModal').classList.remove('active');
            
            // Check if there are more ties
            const hasTies = await checkForTies();
            
            if (!hasTies) {
                await finalizeResults();
            }
        }
        
        async function finalizeResults() {
            judgesData.completed = true;
            judgesData.tiebreakers = tiebreakers;
            await window.setDoc(window.doc(window.db, 'judges', currentYear.toString()), judgesData);
            
            // Update config to mark year as completed
            const configDoc = await window.getDoc(window.doc(window.db, 'config', 'settings'));
            const config = configDoc.data();
            config.yearCompleted[currentYear] = true;
            await window.setDoc(window.doc(window.db, 'config', 'settings'), config);
            
            alert('Scoring completed! Results are now visible.');
            showResults();
        }
        
        function showResults() {
            hideAllScreens();
            document.getElementById('resultsScreen').classList.add('active');
            
            const categories = ['Appetizer', 'Entree', 'Dessert'];
            let html = '';
            
            categories.forEach(category => {
                const categoryEntries = allEntries.filter(e => e.category === category);
                const averages = {};
                
                categoryEntries.forEach(entry => {
                    const scores = allScores.filter(s => s.stickerNumber === entry.stickerNumber);
                    if (scores.length > 0) {
                        const total = scores.reduce((sum, s) => sum + s.taste + s.texture + s.intentionality + s.presentation + s.categoryFit, 0);
                        averages[entry.stickerNumber] = {
                            score: total / scores.length,
                            entry: entry
                        };
                    }
                });
                
                let sorted = Object.entries(averages).sort((a, b) => b[1].score - a[1].score);
                
                // Apply tiebreaker if exists
                if (judgesData.tiebreakers && judgesData.tiebreakers[category]) {
                    const winner = judgesData.tiebreakers[category];
                    sorted = sorted.sort((a, b) => {
                        if (a[0] === winner) return -1;
                        if (b[0] === winner) return 1;
                        return b[1].score - a[1].score;
                    });
                }
                
                html += `<div class="category-results">`;
                html += `<h3>${category}</h3>`;
                
                if (sorted.length > 0) {
                    const winner = sorted[0];
                    html += `<div class="winner-card">`;
                    html += `<h4>ü•á #${winner[0]} - ${winner[1].entry.dish}</h4>`;
                    html += `<p>by ${winner[1].entry.name}</p>`;
                    html += `<p>Score: ${winner[1].score.toFixed(2)} / 25</p>`;
                    html += `</div>`;
                    
                    if (sorted.length > 1) {
                        html += `<div class="runner-up">`;
                        html += `<strong>ü•à #${sorted[1][0]} - ${sorted[1][1].entry.dish}</strong>`;
                        html += ` by ${sorted[1][1].entry.name} (${sorted[1][1].score.toFixed(2)})`;
                        html += `</div>`;
                    }
                    
                    if (sorted.length > 2) {
                        html += `<div class="runner-up">`;
                        html += `<strong>ü•â #${sorted[2][0]} - ${sorted[2][1].entry.dish}</strong>`;
                        html += ` by ${sorted[2][1].entry.name} (${sorted[2][1].score.toFixed(2)})`;
                        html += `</div>`;
                    }
                }
                
                html += `</div>`;
            });
            
            document.getElementById('resultsContent').innerHTML = html;
        }
        
        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        }
        
        function backToJudgeSelect() {
            showJudgeSelect();
        }
        
        function backToDishSelect() {
            showDishSelect();
        }
        
        window.startJudging = startJudging;
        window.selectJudge = selectJudge;
        window.loadRatingForm = loadRatingForm;
        window.backToJudgeSelect = backToJudgeSelect;
        window.backToDishSelect = backToDishSelect;
        window.showCompleteModal = showCompleteModal;
        window.closeCompleteModal = closeCompleteModal;
        window.completeScoring = completeScoring;
        window.submitTiebreaker = submitTiebreaker;
        
        loadYear();
    </script>
</body>
</html>
